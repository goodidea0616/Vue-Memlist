(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1309a99a"],{"0955":function(e,t,s){},"4dec":function(e,t,s){"use strict";s("c2a6")},"4e9b":function(e,t,s){"use strict";s("8efe")},"4fcb":function(e,t,s){},6514:function(e,t,s){},"7b8f":function(e,t,s){"use strict";s("4fcb")},"8efe":function(e,t,s){},"954e":function(e,t,s){"use strict";s("6514")},"996f":function(e,t,s){"use strict";s("a1c0")},a1c0:function(e,t,s){},a63a:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"px-5",attrs:{id:"page-users"}},[s("h5",{staticClass:"mb-6 ml-2"},[e._v("Användare")]),s("UsersTable",{attrs:{items:e.users,titles:e.titles},on:{inviteUserClicked:e.inviteUser,createUserClicked:e.createUser,selectUserClicked:e.selectUser,deleteUserClicked:e.deleteUser,changeUserAccess:e.changeUserAccess,toastr:e.toastr}}),e.inviting?s("b-card",{staticClass:"mb-2",staticStyle:{"max-width":"40rem"},attrs:{title:"Bjud in användare",tag:"article"}},[s("b-card-text",[e._v(" Lägg till en ny användare genom att ange e-postadressen till personen nedan. ")]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.inviteEmail(t)}}},[s("b-form-input",{attrs:{id:"invite-email",required:"",placeholder:"E-post"},model:{value:e.invite_email,callback:function(t){e.invite_email=t},expression:"invite_email"}}),s("b-button",{staticClass:"mt-2 mr-2",attrs:{type:"button",variant:"primary"},on:{click:e.hideInvite}},[e._v("Avbryt")]),s("b-button",{staticClass:"mt-2",attrs:{type:"submit",variant:"primary"}},[e._v("Bjud in")])],1)],1):e._e(),s("div",{staticClass:"scroll-to-container"}),e.creating||e.editing?s("b-card",{ref:"edit-user",staticClass:"mb-2 edit-user-container",attrs:{title:"",id:"edit-user","hide-footer":""}},[s("v-tabs",{attrs:{"background-color":"white",color:"accent-4",right:""}},[s("v-tab",[e._v("Användardata")]),e.editing?s("v-tab",[e._v("Tillgång")]):e._e(),e.editing?s("v-tab",[e._v("Notifikationer")]):e._e(),e.editing&&e.isTalongAdmin?s("v-tab",[e._v("Föreningar")]):e._e(),s("v-tab-item",[s("UserEdit",{attrs:{creating:e.creating,user_id:e.user_id,companyTitles:e.companyTitles},on:{saveUser:e.saveUser,accessLoaded:e.accessLoaded,userCreated:e.userCreated}})],1),e.editing?s("v-tab-item",[s("b-alert",{staticClass:"mt-8",attrs:{show:"",variant:"light"}},[e._v(' Användaren kommer att få tillgång till angivna sidor för respektive förening. Ifall "Kan tilldela" är i checkad så kan användaren ge den tillgången till andra användare. ')]),s("UserPagesAccess",{attrs:{user_id:e.user_id,access_list:e.accessList},on:{updatedAccess:e.loadAllAccess}})],1):e._e(),e.editing?s("v-tab-item",[s("b-alert",{staticClass:"mt-8",attrs:{show:"",variant:"light"}},[e._v(" Följande notifikationer kommer användaren att ta del av per förening. Observera att avgift tillkommer på skickade SMS. ")]),s("UserNotifications",{staticClass:"mt-8",attrs:{company_access:e.companyAccess}})],1):e._e(),e.editing&&e.isTalongAdmin?s("v-tab-item",[s("b-alert",{staticClass:"mt-8",attrs:{show:"",variant:"light"}},[e._v(" Ange vilka föreningar som användaren ska ha tillgång till ")]),s("UserCompanyAccess",{staticClass:"mt-8",attrs:{user_id:e.user_id,company_access:e.companyAccess,companies:e.companies}})],1):e._e()],1)],1):e._e()],1)},n=[],c=(s("99af"),s("4de4"),s("c740"),s("a434"),s("b0c0"),s("b85c")),i=(s("96cf"),s("1da1")),r=s("5530"),o=s("c789"),l=s("bc3a"),d=s.n(l),u=s("2f62"),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"card card-custom card-stretch gutter-b"},[s("div",{staticClass:"card-header border-0 py-5"},[s("h3",{staticClass:"card-title align-items-start flex-column pl-2"}),s("div",{staticClass:"card-toolbar"},[s("a",{staticClass:"btn btn-primary font-weight-bolder font-size-sm mr-2 my-2",attrs:{href:"#"},on:{click:e.inviteUserClicked}},[s("i",{staticClass:"menu-icon flaticon2-plus",staticStyle:{"font-size":"1.0em"}}),e._v("Bjud in")]),s("a",{staticClass:"btn btn-primary font-weight-bolder font-size-sm",attrs:{href:"#"},on:{click:e.createUserClicked}},[s("i",{staticClass:"menu-icon flaticon2-plus",staticStyle:{"font-size":"1.0em"}}),e._v("Ny Användare")])])]),s("div",{staticClass:"card-body pt-0 table-responsive"},[s("b-table",{staticClass:"mh-100",attrs:{id:"template-table",fields:e.headers,items:e.items,"head-variant":"light","sticky-header":""},scopedSlots:e._u([{key:"cell(director)",fn:function(t){return[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.item.director,expression:"row.item.director"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(t.item.director)?e._i(t.item.director,null)>-1:t.item.director},on:{change:[function(s){var a=t.item.director,n=s.target,c=!!n.checked;if(Array.isArray(a)){var i=null,r=e._i(a,i);n.checked?r<0&&e.$set(t.item,"director",a.concat([i])):r>-1&&e.$set(t.item,"director",a.slice(0,r).concat(a.slice(r+1)))}else e.$set(t.item,"director",c)},function(s){return e.clickedDirector(t.item)}]}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])]}},{key:"cell(accountant)",fn:function(t){return[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.item.accountant,expression:"row.item.accountant"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(t.item.accountant)?e._i(t.item.accountant,null)>-1:t.item.accountant},on:{change:[function(s){var a=t.item.accountant,n=s.target,c=!!n.checked;if(Array.isArray(a)){var i=null,r=e._i(a,i);n.checked?r<0&&e.$set(t.item,"accountant",a.concat([i])):r>-1&&e.$set(t.item,"accountant",a.slice(0,r).concat(a.slice(r+1)))}else e.$set(t.item,"accountant",c)},function(s){return e.clickedAccountant(t.item)}]}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])]}},{key:"cell(id)",fn:function(t){return[s("div",{staticClass:"justify-content-end d-flex"},[s("a",{staticClass:"btn btn-icon btn-light btn-sm mx-3",attrs:{href:"#"},on:{click:function(s){return e.selectUserClicked(t.item.user_id)}}},[s("span",{staticClass:"svg-icon svg-icon-md svg-icon-primary"},[s("inline-svg",{attrs:{src:"/assets/svg/Write.svg"}})],1)]),s("a",{staticClass:"btn btn-icon btn-light btn-sm mr-3",attrs:{href:"#"},on:{click:function(s){return e.deleteUserClicked(t.item.user_id)}}},[s("span",{staticClass:"svg-icon svg-icon-md svg-icon-primary"},[s("inline-svg",{attrs:{src:"/assets/svg/Trash.svg"}})],1)]),e.isTalongAdmin?s("a",{staticClass:"btn btn-icon btn-light btn-sm mr-3",attrs:{href:e.getLoginLink(t.item)},on:{click:function(s){return e.loginUserClicked(t.item.user_id)}}},[s("span",{staticClass:"svg-icon svg-icon-md svg-icon-primary"},[s("i",{staticClass:"fas fa-sign-in-alt",staticStyle:{"font-size":"48px",color:"#3699FF"}})])]):e._e()])]}}])})],1)])])},h=[],p=(s("4160"),s("159b"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tr",[s("td",[s("span",{staticClass:"text-dark-75 font-weight-bolder d-block font-size-lg pl-4"},[e._v(e._s(e.user.name))])]),s("td",[s("span",{staticClass:"text-dark-75 font-weight-bolder d-block font-size-lg"},[e._v(e._s(e.user.email))])]),s("td",[s("span",{staticClass:"text-dark-75 font-weight-bolder d-block font-size-lg"},[e._v(e._s(e.user.title))])]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.is_director,expression:"is_director"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.is_director)?e._i(e.is_director,null)>-1:e.is_director},on:{change:[function(t){var s=e.is_director,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.is_director=s.concat([c])):i>-1&&(e.is_director=s.slice(0,i).concat(s.slice(i+1)))}else e.is_director=n},function(t){return e.clickedDirector()}]}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.is_accountant,expression:"is_accountant"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.is_accountant)?e._i(e.is_accountant,null)>-1:e.is_accountant},on:{change:[function(t){var s=e.is_accountant,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.is_accountant=s.concat([c])):i>-1&&(e.is_accountant=s.slice(0,i).concat(s.slice(i+1)))}else e.is_accountant=n},function(t){return e.clickedAccountant()}]}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])]),s("td",{staticClass:"text-right pr-0"},[s("div",{staticClass:"d-flex justify-content-end"},[s("a",{staticClass:"btn btn-icon btn-light btn-sm mx-3",attrs:{href:"#"},on:{click:function(t){return e.selectUserClicked(e.user.user_id)}}},[s("span",{staticClass:"svg-icon svg-icon-md svg-icon-primary"},[s("inline-svg",{attrs:{src:"/assets/svg/Write.svg"}})],1)]),s("a",{staticClass:"btn btn-icon btn-light btn-sm mr-3",attrs:{href:"#"},on:{click:function(t){return e.deleteUserClicked(e.user.user_id)}}},[s("span",{staticClass:"svg-icon svg-icon-md svg-icon-primary"},[s("inline-svg",{attrs:{src:"/assets/svg/Trash.svg"}})],1)])])])])}),g=[],f={name:"users-table-row",props:["user"],computed:Object(r["a"])({},Object(u["b"])(["currentCompanyId","titles"])),data:function(){return{is_director:!1,is_accountant:!1}},mounted:function(){this.is_director=this.user.director,this.is_accountant=this.user.accountant},watch:{user:function(e,t){this.is_director=this.user.director,this.is_accountant=this.user.accountant},is_director:function(e,t){},is_accountant:function(e,t){}},methods:{clickedDirector:function(){var e=this;d.a.put("/company/director",{company_id:this.currentCompanyId,user_id:this.user.user_id,is_director:this.is_director?1:0}).then((function(t){204===t.status&&(e.$emit("toastr","success","OK","Styrelse ändrad"),e.$emit("changeUserAccess",e.user.user_id,e.is_director,e.is_accountant))})).catch((function(t){e.$emit("toastr","danger","Server Fel","Kunde inte ändra styrelse"),e.is_director=!e.is_director}))},clickedAccountant:function(){var e=this;d.a.put("/company/accountant",{company_id:this.currentCompanyId,user_id:this.user.user_id,is_accountant:this.is_accountant?1:0}).then((function(t){204===t.status?(e.$emit("toastr","success","OK","Revisor ändrad"),e.$emit("changeUserAccess",e.user.user_id,e.is_director,e.is_accountant)):(e.$emit("toastr","danger","Server Fel","Kunde inte ändra revisor"),e.is_accountant=!e.is_accountant)})).catch((function(t){e.$emit("toastr","danger","Fel","Kunde inte ändra revisor"),e.is_accountant=!e.is_accountant}))},selectUserClicked:function(e){this.$emit("selectUserClicked",e)},deleteUserClicked:function(e){this.$emit("deleteUserClicked",e)},loginUserClicked:function(e){this.$emit("loginUserClicked",e)},getLoginLink:function(){var e=this.$router.resolve({path:"/ml-tokenlogin/".concat(this.user.auth_token,"/ml-dashboard")});return e.href},getTitle:function(e){return this.titles.forEach((function(t){if(t.id==e)return t.name})),""}}},v=f,_=(s("d937"),s("2877")),b=Object(_["a"])(v,p,g,!1,null,"7e45b4e4",null),k=b.exports,A={name:"users-table",props:["items","titles"],components:{UserTableRow:k},computed:Object(r["a"])({},Object(u["b"])(["currentCompanyId","isTalongAdmin"])),methods:{inviteUserClicked:function(){this.$emit("inviteUserClicked")},createUserClicked:function(){this.$emit("createUserClicked")},selectUserClicked:function(e){this.$emit("selectUserClicked",e)},deleteUserClicked:function(e){this.$emit("deleteUserClicked",e)},loginUserClicked:function(e){this.$emit("loginUserClicked",e)},changeUserAccess:function(e,t,s){this.$emit("changeUserAccess",e,t,s)},clickedDirector:function(e){var t=this;d.a.put("/company/director",{company_id:this.currentCompanyId,user_id:e.user_id,is_director:e.director?1:0}).then((function(s){204===s.status&&(t.$emit("toastr","success","OK","Styrelse ändrad"),t.changeUserAccess(e.user_id,e.director,e.accountant))})).catch((function(s){t.$emit("toastr","danger","Server Fel","Kunde inte ändra styrelse"),e.director=!e.director}))},clickedAccountant:function(e){var t=this;console.log("User"),d.a.put("/company/accountant",{company_id:this.currentCompanyId,user_id:e.user_id,is_accountant:e.is_accountant?1:0}).then((function(s){204===s.status?(t.$emit("toastr","success","OK","Revisor ändrad"),t.changeUserAccess(e.user_id,e.director,e.accountant)):(t.$emit("toastr","danger","Server Fel","Kunde inte ändra revisor"),e.accountant=!e.accountant)})).catch((function(s){t.$emit("toastr","danger","Fel","Kunde inte ändra revisor"),e.accountant=!e.accountant}))},getLoginLink:function(e){var t=this.$router.resolve({path:"/ml-tokenlogin/".concat(e.auth_token,"/ml-dashboard")});return t.href},toastr:function(e,t,s){this.$emit("toastr",e,t,s)},getTitle:function(e){return this.titles.forEach((function(t){if(t.id==e)return t.name})),""}},data:function(){return{headers:[{key:"name",label:"Namn",sortable:!0,thClass:"pl-7",tdClass:"pl-7 vertical-center"},{key:"email",label:"E-post",thClass:"w-200px",tdClass:"w-200px vertical-center",sortable:!0},{key:"title",label:"Titel",thClass:"w-200px",tdClass:"w-200px vertical-center",sortable:!0},{key:"director",label:"Styrelse",thClass:"w-85px",tdClass:"w-85px vertical-center",sortable:!0},{key:"accountant",label:"Revisor",thClass:"w-85px",tdClass:"w-85px vertical-center",sortable:!0},{key:"id",label:"",thClass:"w-110px text-right vertical-center"}],list:[]}}},y=A,C=(s("fd49"),Object(_["a"])(y,m,h,!1,null,"5cae9013",null)),x=C.exports,U=s("0929"),w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"table-responsive"},[s("table",{staticClass:"table table-head-custom table-vertical-center table-head-bg table-borderless"},[e._m(0),s("tbody",[e._l(e.companies,(function(t,a){return[s("UserCompanyAccessRow",{key:a,attrs:{company_id:t.company.company_id,name:t.company.name,user_id:e.user_id,has_access:e.hasAccess(t.company.company_id)}})]}))],2)])])},O=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("thead",[s("tr",{staticClass:"text-left"},[s("th",[e._v("Förening")]),s("th")])])}],$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tr",[s("td",[s("span",{staticClass:"d-block font-size-lg"},[e._v(e._s(e.name))])]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.access,expression:"access"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.access)?e._i(e.access,null)>-1:e.access},on:{click:e.updateAccess,change:function(t){var s=e.access,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.access=s.concat([c])):i>-1&&(e.access=s.slice(0,i).concat(s.slice(i+1)))}else e.access=n}}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])])])},K=[],F={name:"user-access-row",props:["name","has_access","company_id","user_id"],computed:Object(r["a"])({},Object(u["b"])(["currentCompanyId"])),data:function(){return{access:!1}},mounted:function(){this.access=this.has_access},watch:{has_access:function(e,t){this.access=e},access:function(e,t){}},methods:{updateAccess:function(){this.access=!this.access,this.setCompanyAccess(this.user_id,this.company_id,this.access)},setCompanyAccess:function(e,t,s){var a=this;d.a.put("/user/setcompanyaccess",{user_id:e,company_id:t,access:s,silent:!0}).then((function(e){a.toastr("success","OK","Uppdaterat")})).catch((function(e){console.error(e),a.toastr("danger","Fel","Kunde inte uppdatera")}))},toastr:function(e,t,s){this.$bvToast.toast(s,{title:t,autoHideDelay:2e3,appendToast:!0,variant:e})}}},T=F,I=(s("4e9b"),Object(_["a"])(T,$,K,!1,null,"9a4042ac",null)),j=I.exports,P={name:"user-access",props:["user_id","company_access","companies"],components:{UserCompanyAccessRow:j},methods:{hasAccess:function(e){var t,s=Object(c["a"])(this.company_access);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(a.company.id===e)return!0}}catch(n){s.e(n)}finally{s.f()}return!1}}},S=P,R=(s("996f"),Object(_["a"])(S,w,O,!1,null,"a736c90c",null)),E=R.exports,D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"table-responsive"},[s("table",{staticClass:"table table-head-custom table-vertical-center table-head-bg table-borderless"},[s("tbody",[e._l(e.access_list,(function(t,a){return[s("UserPagesCompanyTable",{key:a,attrs:{company_id:t.company.id,name:t.company.name,user_id:e.user_id,access_list:t.acl},on:{updatedAccess:function(t){return e.$emit("updatedAccess")}}})]}))],2)])])},L=[],N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"table-responsive"},[s("table",{staticClass:"table table-head-custom table-vertical-center table-head-bg table-borderless"},[s("tr",{staticClass:"tr-black"},[s("td",{staticStyle:{"min-width":"300px","max-width":"300px"}},[e._v(e._s(e.name))]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.checkAllPages,expression:"checkAllPages"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.checkAllPages)?e._i(e.checkAllPages,null)>-1:e.checkAllPages},on:{click:e.checkAllPagesClicked,change:function(t){var s=e.checkAllPages,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.checkAllPages=s.concat([c])):i>-1&&(e.checkAllPages=s.slice(0,i).concat(s.slice(i+1)))}else e.checkAllPages=n}}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"},[e._v("Har tillgång")])])]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.checkAllAdmin,expression:"checkAllAdmin"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.checkAllAdmin)?e._i(e.checkAllAdmin,null)>-1:e.checkAllAdmin},on:{click:e.checkAllAdminClicked,change:function(t){var s=e.checkAllAdmin,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.checkAllAdmin=s.concat([c])):i>-1&&(e.checkAllAdmin=s.slice(0,i).concat(s.slice(i+1)))}else e.checkAllAdmin=n}}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"},[e._v("Kan tilldela")])])])]),e._l(e.sorted_access_list,(function(t,a){return[s("UserPagesCompanyTableRow",{key:a,attrs:{user_id:e.user_id,company_id:e.company_id,a:t.a,p:t.p,page:t.name},on:{pageAccessUpdated:e.pageAccessUpdated,adminAccessUpdated:e.adminAccessUpdated}})]}))],2)])},B=[],M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tr",[s("td",[s("span",{staticClass:"d-block font-size-lg"},[e._v(e._s(e.name))])]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.pageAccess,expression:"pageAccess"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.pageAccess)?e._i(e.pageAccess,null)>-1:e.pageAccess},on:{click:e.updatePageAccess,change:function(t){var s=e.pageAccess,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.pageAccess=s.concat([c])):i>-1&&(e.pageAccess=s.slice(0,i).concat(s.slice(i+1)))}else e.pageAccess=n}}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])]),s("td",[s("div",{staticClass:"d-flex align-items-center"},[s("label",{staticClass:"checkbox checkbox-lg checkbox-outline checkbox-success"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.adminAccess,expression:"adminAccess"}],attrs:{type:"checkbox",name:""},domProps:{checked:Array.isArray(e.adminAccess)?e._i(e.adminAccess,null)>-1:e.adminAccess},on:{click:e.updateAdminAccess,change:function(t){var s=e.adminAccess,a=t.target,n=!!a.checked;if(Array.isArray(s)){var c=null,i=e._i(s,c);a.checked?i<0&&(e.adminAccess=s.concat([c])):i>-1&&(e.adminAccess=s.slice(0,i).concat(s.slice(i+1)))}else e.adminAccess=n}}}),s("span")]),s("span",{staticClass:"ml-3 cursor-pointer"})])])])},z=[],H=s("ade3"),q={name:"user-pages-company-table-row",props:["company_id","user_id","a","p","page"],computed:Object(r["a"])(Object(r["a"])({},Object(u["b"])(["currentCompanyId"])),{},{name:function(){return this.names[this.page]}}),data:function(){return{pageAccess:!1,adminAccess:!1,names:Object(H["a"])({"ml-admin":"Helpdesk","ml-users":"Användare","ml-advanced-search":"Avancerat sök","ml-apikeys":"API Nycklar","ml-book":"Bokföring","ml-dashboard":"Dashboard","ml-companies":"Föreningar","ml-errors":"Felrapporter","ml-events":"Evenemang","ml-files":"Filer","ml-import":"Import Medlemmar","ml-importcompanies":"Import Föreningar","ml-billing":"Kostnader","ml-ladok":"LADOK","ml-member-manager":"Medlemshanterare","ml-mucf":"MUCF","ml-periods":"Perioder","ml-properties":"Attribut","ml-quicksearch":"Snabbsök","ml-language":"Språk","ml-registersetup":"Registreringswizard","ml-sendout":"Utskick","ml-settings":"Inställningar","ml-shopitem":"Butik","ml-stickprov":"Stickprover","ml-subcompany":"Underföreningar","ml-support":"Support","ml-system":"System","ml-templates":"Mallar","ml-todo":"Ärendehantering"},"ml-todo","Betalningar")}},mounted:function(){this.adminAccess="a"===this.a,this.pageAccess="rw"===this.p},watch:{a:function(e,t){this.adminAccess="a"===e},p:function(e,t){this.pageAccess="rw"===e}},methods:{updatePageAccess:function(){this.$emit("pageAccessUpdated",this.page,this.pageAccess?"-":"rw")},updateAdminAccess:function(){this.$emit("adminAccessUpdated",this.page,this.adminAccess?"-":"a")},toastr:function(e,t,s){this.$bvToast.toast(s,{title:t,autoHideDelay:2e3,appendToast:!0,variant:e})}}},V=q,J=(s("7b8f"),Object(_["a"])(V,M,z,!1,null,"4e1d59a2",null)),W=J.exports,Y={name:"user-pages-company-table",props:["user_id","company_id","name","access_list"],components:{UserPagesCompanyTableRow:W},computed:Object(r["a"])({},Object(u["b"])(["currentCompanyId","currentUserId"])),watch:{access_list:function(e,t){this.sortAccessList()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("UserPagesCompanyTable acl:"),console.log(e.access_list),e.sortAccessList();case 3:case"end":return t.stop()}}),t)})))()},methods:{sortAccessList:function(){for(var e in this.sorted_access_list=[],this.access_list){var t=this.access_list[e];this.sorted_access_list.push({name:e,p:t.p,a:t.a,caption:this.names[e]})}this.sorted_access_list.sort((function(e,t){return e.caption<t.caption?-1:1}))},pageAccessUpdated:function(e,t){var s=this;console.log("currentUserId: "+this.currentUserId),console.log("user_id: "+this.user_id),this.currentUserId!==this.user_id?d.a.put("/company_user",{company_id:this.company_id,user_id:this.user_id,page:e,p:t}).then((function(e){s.toastr("success","OK","Tillgång uppdaterad"),s.$emit("updatedAccess")})).catch((function(e){console.error(e),s.toastr("danger","Fel","Kunde inte ändra tillgång")})):this.toastr("danger","Fel","Du kan inte ändra rättigheter för dig själv")},adminAccessUpdated:function(e,t){var s=this;this.currentUserId!==this.user_id?d.a.put("/company_user",{company_id:this.company_id,user_id:this.user_id,page:e,a:t}).then((function(e){s.toastr("success","OK","Rättighet uppdaterad"),s.$emit("updatedAccess")})).catch((function(e){console.error(e),s.toastr("danger","Fel","Kunde inte ändra rättighet")})):this.toastr("danger","Fel","Du kan inte ändra rättigheter för dig själv")},checkAllAdminClicked:function(){var e=this;this.currentUserId!==this.user_id?(this.checkAllAdmin=!this.checkAllAdmin,d.a.put("/company_user/all",{company_id:this.company_id,user_id:this.user_id,a:this.checkAllAdmin?"a":"-"}).then((function(t){e.toastr("success","OK","Alla tillgångar i föreningen har uppdaterats för användaren"),e.$emit("updatedAccess")})).catch((function(t){console.error(t),e.toastr("danger","Fel","Kunde inte uppdatera alla tillgångar")}))):this.toastr("danger","Fel","Du kan inte ändra rättigheter för dig själv")},checkAllPagesClicked:function(){var e=this;this.currentUserId!==this.user_id?(this.checkAllPages=!this.checkAllPages,d.a.put("/company_user/all",{company_id:this.company_id,user_id:this.user_id,p:this.checkAllPages?"rw":"-"}).then((function(t){e.toastr("success","OK","Alla tillgångar i föreningen har uppdaterats för användaren"),e.$emit("updatedAccess")})).catch((function(t){console.error(t),e.toastr("danger","Fel","Kunde inte uppdatera alla tillgångar")}))):this.toastr("danger","Fel","Du kan inte ändra rättigheter för dig själv")},toastr:function(e,t,s){this.$bvToast.toast(s,{title:t,autoHideDelay:2e3,appendToast:!0,variant:e})}},data:function(){return{names:{"ml-admin":"Helpdesk","ml-users":"Användare","ml-advanced-search":"Avancerat sök","ml-apikeys":"API Nycklar","ml-book":"Bokföring","ml-dashboard":"Dashboard","ml-companies":"Föreningar","ml-errors":"Felrapporter","ml-events":"Evenemang","ml-files":"Filer","ml-import":"Import Medlemmar","ml-importcompanies":"Import Föreningar","ml-billing":"Kostnader","ml-ladok":"LADOK","ml-member-manager":"Medlemshanterare","ml-mucf":"MUCF","ml-periods":"Perioder","ml-properties":"Attribut","ml-quicksearch":"Snabbsök","ml-language":"Språk","ml-registersetup":"Registreringswizard","ml-sendout":"Utskick","ml-settings":"Inställningar","ml-shopitem":"Butik","ml-stickprov":"Stickprover","ml-subcompany":"Underföreningar","ml-support":"Support","ml-system":"System","ml-templates":"Mallar","ml-todo":"Ärendehantering","ml-payments":"Betalningar"},sorted_access_list:[],checkAllPages:!1,checkAllAdmin:!1,companies:[]}}},G=Y,Q=(s("954e"),Object(_["a"])(G,N,B,!1,null,"6e647b64",null)),X=Q.exports,Z={name:"user-pages-access",props:["user_id","access_list"],components:{UserPagesCompanyTable:X}},ee=Z,te=(s("af76"),Object(_["a"])(ee,D,L,!1,null,"848e7534",null)),se=te.exports,ae=s("0611"),ne={name:"users",components:{UsersTable:x,UserNotifications:U["a"],UserEdit:ae["a"],UserCompanyAccess:E,UserPagesAccess:se},computed:Object(r["a"])({},Object(u["b"])(["currentCompanyId","currentPeriodId","periods","isTalongAdmin"])),mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:e.user_id=e.$route.params.id,""===e.user_id||null===e.user_id||void 0===e.user_id?(e.editing=!1,e.creating=!1):(e.editing=!0,e.selectUser(e.user_id));case 4:case"end":return t.stop()}}),t)})))()},data:function(){return{user_id:null,system_pages_translate:{"ml-dashboard":"Dashboard","ml-todo":"Ärendehantering","ml-errors":"Felrapporter","ml-events":"Evenemang","ml-quicksearch":"Snabbsök","ml-advanced-search":"Avancerat sök","ml-import":"Import","ml-stickprov":"Stickprov","ml-ladok":"LADOK","ml-properties":"Attribut","ml-member-manager":"Medlemshanterare","ml-mucf":"MUCF","ml-settings":"Inställningar","ml-registersetup":"Registreringswizard","ml-periods":"Perioder","ml-users":"Användare","ml-subcompany":"Underföreningar","ml-files":"Filer","ml-shopitem":"Butik","ml-book":"Bokföring","ml-sendout":"Utskick","ml-templates":"Mallar","ml-support":"Support","ml-billing":"Kostnader","ml-admin":"Administration","ml-companies":"Föreningslista","ml-language":"Språk","ml-system":"System"},titles:[],company:{},companies:[],accessList:[],companyAccess:[],form:{user_id:"",email:"",firstname:"",lastname:"",is_accountant:!1,is_director:!1,title_id:"",public_sex:"U",sex:"U"},invite_email:"",genders:[{value:"M",text:"Man"},{value:"F",text:"Kvinna"},{value:"O",text:"Annat"},{value:"U",text:"Okänt"}],companyTitles:[],creating:!1,editing:!1,inviting:!1,users:[],access:[],tmpAccess:[],tmpAccessAdmin:[],checkedAccess:[],checkedAccessAdmin:[],checkedAll:!1,checkedAllAdmin:!1}},watch:{currentCompanyId:function(e,t){e&&this.loadUsers()},checkedAll:function(e,t){this.checkAllPerm(e?1:0)},checkedAllAdmin:function(e,t){this.checkAllAdminPerm(e?1:0)},checkedAccess:function(e,t){var s=this;if(e.length===this.tmpAccess.length){for(var a=!1,n=0;n<this.tmpAccess.length;++n)if(this.tmpAccess[n]!==e[n]){a=!0;break}if(!a)return}if(t.length<e.length){var c="";for(n=0;n<e.length;++n){for(var i=!1,r=0;r<t.length;++r)if(e[n]===t[r]){i=!0;break}if(!i){c=e[n];break}}d.a.put("/company/set_page_perm",{company_id:this.currentCompanyId,user_id:this.user_id,page_name:c,perm:1}).then((function(e){204===e.status&&s.toastr("success","OK","Rättighet tilldelad")})).catch((function(e){console.error(e),s.toastr("danger","Server Fel","Kunde inte tilldela rättighet")}))}else{var o="";for(n=0;n<t.length;++n){for(i=!1,r=0;r<e.length;++r)if(e[r]===t[n]){i=!0;break}if(!i){o=t[n];break}}d.a.put("/company/set_page_perm",{company_id:this.currentCompanyId,user_id:this.user_id,page_name:o,perm:0}).then((function(e){204===e.status&&s.toastr("success","OK","Rättighet uppdaterad")})).catch((function(e){console.error(e),s.toastr("danger","Server Fel","Kunde inte uppdatera rättighet")}))}},checkedAccessAdmin:function(e,t){var s=this;if(e.length===this.tmpAccessAdmin.length){console.log("inside workaround");for(var a=!1,n=0;n<this.tmpAccessAdmin.length;++n)if(this.tmpAccessAdmin[n]!==e[n]){a=!0;break}if(!a)return}if(console.log("proceeding"),t.length<e.length){var c="";for(n=0;n<e.length;++n){for(var i=!1,r=0;r<t.length;++r)if(e[n]===t[r]){i=!0;break}if(!i){c=e[n];break}}d.a.put("/company/set_page_adm",{company_id:this.currentCompanyId,user_id:this.user_id,page_name:c,adm:1}).then((function(e){204===e.status&&s.toastr("success","OK","Rättighet tilldelad")})).catch((function(e){console.error(e),s.toastr("danger","Server Fel","Kunde inte tilldela rättighet")}))}else{var o="";for(n=0;n<t.length;++n){for(i=!1,r=0;r<e.length;++r)if(e[r]===t[n]){i=!0;break}if(!i){o=t[n];break}}d.a.put("/company/set_page_admin",{company_id:this.currentCompanyId,user_id:this.user_id,page_name:o,adm:0}).then((function(e){204===e.status&&s.toastr("success","OK","Rättighet uppdaterad")})).catch((function(e){console.error(e),s.toastr("danger","Server Fel","Kunde inte uppdatera rättighet")}))}console.log(this.checkedAccessAdmin)},user_id:function(e,t){var s=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}return t.next=3,s.loadAllAccess();case 3:return t.next=5,s.loadUserAccess();case 5:return t.next=7,s.loadCompanies();case 7:case"end":return t.stop()}}),t)})))()}},methods:{loadData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loadUsers();case 1:case"end":return t.stop()}}),t)})))()},inviteUser:function(){this.inviting=!0},setCompany:function(){var e=this;d.a.get("/company?company_id=".concat(this.currentCompanyId)).then((function(t){d.a.get("/system/titles").then((function(s){var a=s.data.titles,n=t.data.company.settings.titles;null!==n&&void 0!==n||(n=[]),e.titles=[];var i,r=Object(c["a"])(n);try{for(r.s();!(i=r.n()).done;){var o,l=i.value,d=Object(c["a"])(a);try{for(d.s();!(o=d.n()).done;){var u=o.value;if(l===u.id){e.titles.push(u);break}}}catch(h){d.e(h)}finally{d.f()}}}catch(h){r.e(h)}finally{r.f()}e.companyTitles=[];for(var m=0;m<e.titles.length;++m)e.companyTitles.push({text:e.titles[m].name,value:e.titles[m].id})})).catch((function(t){console.error(t),e.toastr("danger","Fel","Kunde inte hämta systemtitlar")}))})).catch((function(t){console.error(t),e.toastr("danger","Fel","Kunde inte hämta inställningar")}))},createUser:function(){this.creating=!0,this.editing=!1,this.user_id=null,this.form={},this.scrollToEditUser()},deleteUser:function(e){var t=this;d.a.delete("/user/remove_from_company?user_id=".concat(e,"&company_id=").concat(this.currentCompanyId)).then((function(s){t.users=t.users.filter((function(t){return t.user_id!==e})),t.creating=!1,t.editing=!1,t.toastr("success","OK","Användaren togs bort")})).catch((function(e){console.error(e),t.toastr("danger","Server Fel","Kunde inte ta bort användare")}))},accessLoaded:function(e){this.loadAccess(e,this.currentCompanyId)},selectUser:function(e){this.user_id=e,this.editing=!0,this.scrollToEditUser()},changeUserAccess:function(e,t,s){this.user_id==e&&this.selectUser(e)},loadAccess:function(e,t){this.access=[],this.tmpAccessAdmin=[],this.tmpAccess=[];var s=[],a=[];if(void 0!==e)for(var n=0;n<e.length;++n){var c=e[n];c.su||(this.access.push({pag:c.pag,adm:c.adm,per:c.per,text:this.getLangText(c.pag,"sv")}),"rw"!==c.per&&"r"!==c.per||(s.push(c.pag),this.tmpAccess.push(c.pag)),"a"===c.adm&&(a.push("a"),this.tmpAccessAdmin.push("a")))}this.checkedAccess=s,this.checkedAccessAdmin=a},loadAllAccess:function(){var e=this,t=this.$loading.show();console.log("loading access for "+this.user_id),d.a.get("/company_user/admin?user_id=".concat(this.user_id,"&company_id=").concat(this.currentCompanyId)).then((function(s){e.accessList=s.data,t.hide()})).catch((function(s){console.error(s),t.hide(),e.toastr("danger","Fel","Kunde inte hämta alla rättigheter")}))},loadUserAccess:function(){var e=this,t=this.$loading.show();d.a.get("/user/allaccess?user_id=".concat(this.user_id)).then((function(s){e.companyAccess=s.data.company_access,t.hide()})).catch((function(s){console.error(s),t.hide(),e.toastr("danger","Fel","Kunde inte hämta alla rättigheter")}))},loadCompanies:function(){var e=this,t=this.$loading.show();d.a.get("/company/list").then((function(s){e.companies=s.data.companies,e.companies.sort((function(e,t){return e.company.name<t.company.name?-1:1})),t.hide()})).catch((function(s){console.error(s),t.hide(),e.toastr("danger","Fel","Kunde inte lista alla föreningar")}))},getLangText:function(e,t){return this.system_pages_translate[e]},loadUsers:function(){var e=this;this.setCompany(),this.users=[],d.a.get("/company/listusers?company_id=".concat(this.currentCompanyId)).then((function(t){200===t.status&&(e.users=t.data.users)})).catch((function(t){console.error(t),e.toastr("danger","Server Fel","Kunde inte lista användare")}))},personnrChanged:function(e){var t=Object(o["a"])(this.form.in_personnr);this.form.fmt_personnr=t.formatted,this.form.sex=t.sex},scrollToClassName:function(e){var t=this;setTimeout((function(){var s=t.$el.getElementsByClassName(e)[0];if(s){var a=-70,n=s.getBoundingClientRect().top+window.pageYOffset+a;window.scrollTo({top:n,behavior:"smooth"})}}),100)},scrollToEditUser:function(){var e=this;setTimeout((function(){var t=e.$el.getElementsByClassName("scroll-to-container")[0];if(t){var s=-70,a=t.getBoundingClientRect().top+window.pageYOffset+s;window.scrollTo({top:a,behavior:"smooth"})}}),100)},userCreated:function(e){this.form=e,this.creating=!1},saveUser:function(e){var t=this;this.form=e,this.creating?d.a.post("/user/create",this.form).then((function(e){switch(e.status){case 201:var s={access:!0,accountant:t.form.is_accountant,director:t.form.is_director,email:t.form.email,name:"".concat(t.form.firstname," ").concat(t.form.lastname),title:t.form.title_id,user_id:e.data.user.user_id};t.users.splice(0,0,s),t.loadAccess(e.data.access,t.currentCompanyId),t.creating=!1,t.editing=!1,t.scrollToClassName("table-responsive"),t.toastr("success","OK","Användare skapad");break;case 409:t.toastr("danger","Ogiltig e-postadress","Den angivna e-postadressen finns redan.");break}})).catch((function(e){t.toastr("danger","Server Fel","Kunde inte skapa användare")})):d.a.put("/user",this.form).then((function(e){switch(e.status){case 200:case 204:var s,a={value:"",text:""},n=Object(c["a"])(t.companyTitles);try{for(n.s();!(s=n.n()).done;){var i=s.value;if(i.value===t.form.title_id){a=i;break}}}catch(l){n.e(l)}finally{n.f()}var r={access:!0,accountant:t.form.is_accountant,director:t.form.is_director,email:t.form.email,name:"".concat(t.form.firstname," ").concat(t.form.lastname),title:a.text,title_id:t.form.title_id,user_id:t.form.user_id},o=t.users.findIndex((function(e){return e.user_id==r.user_id}));o>-1&&t.users.splice(o,1,r),t.loadAccess(e.data.access,t.currentCompanyId),t.scrollToClassName("table-responsive"),t.toastr("success","OK","Användare uppdaterad");break;case 409:t.toastr("danger","Ogiltig e-postadress","Den angivna e-postadressen finns redan.");break}})).catch((function(e){console.error(e,"err"),t.toastr("danger","Server Fel","Kunde inte uppdatera användare")}))},hideInvite:function(){this.inviting=!1},inviteEmail:function(e){var t=this;e.preventDefault(),d.a.post("/company/invite",{email:this.invite_email,company_id:this.currentCompanyId}).then((function(e){201===e.status&&(t.users.push({user_id:e.data.user.user_id,email:e.data.user.email,firstname:e.data.user.firstname,lastname:e.data.user.lastname}),t.inviting=!1,t.toastr("success","OK","E-post inbjudan skickad till användaren"))})).catch((function(e){console.error(e),t.toastr("danger","Server Fel","Kunde inte bjuda in via e-post")})),this.invite_email=""},checkAllAdminPerm:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){var a,n,i,r,o;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a={adm:e,user_id:t.user_id,company_id:t.currentCompanyId},s.next=3,d.a.put("/company/set_all_adm",a);case 3:if(n=s.sent,204===n.status){t.toastr("success","OK","Rättighet uppdaterad"),t.checkedAccessAdmin=[],i=Object(c["a"])(t.access);try{for(i.s();!(r=i.n()).done;)o=r.value,o.adm=1===e?"a":"-",1===e&&t.checkedAccessAdmin.push(o.adm)}catch(l){i.e(l)}finally{i.f()}}else t.toastr("danger","Server Fel","Kunde inte uppdatera rättighet");return s.next=7,t.selectUser(t.user_id);case 7:case"end":return s.stop()}}),s)})))()},checkAllPerm:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function s(){var a,n,i,r,o;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a={perm:e,user_id:t.user_id,company_id:t.currentCompanyId},s.next=3,d.a.put("/company/set_all_perm",a);case 3:if(n=s.sent,204===n.status){t.toastr("success","OK","Rättighet uppdaterad"),t.checkedAccess=[],i=Object(c["a"])(t.access);try{for(i.s();!(r=i.n()).done;)o=r.value,o.per=1===e?"rw":"-",1===e&&t.checkedAccess.push(o.pag)}catch(l){i.e(l)}finally{i.f()}}else t.toastr("danger","Server Fel","Kunde inte uppdatera rättighet");return s.next=7,t.selectUser(t.user_id);case 7:case"end":return s.stop()}}),s)})))()},toastr:function(e,t,s){this.$bvToast.toast(s,{title:t,autoHideDelay:2e3,appendToast:!0,variant:e})}}},ce=ne,ie=(s("4dec"),s("6544")),re=s.n(ie),oe=s("71a3"),le=s("c671"),de=s("fe57"),ue=Object(_["a"])(ce,a,n,!1,null,"be38831a",null);t["default"]=ue.exports;re()(ue,{VTab:oe["a"],VTabItem:le["a"],VTabs:de["a"]})},af76:function(e,t,s){"use strict";s("0955")},afcf:function(e,t,s){},c2a6:function(e,t,s){},d937:function(e,t,s){"use strict";s("afcf")},e10d:function(e,t,s){},fd49:function(e,t,s){"use strict";s("e10d")}}]);
//# sourceMappingURL=chunk-1309a99a.11c5731a.js.map