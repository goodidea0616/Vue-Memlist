(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57badf00"],{"1b0f":function(t,e,a){"use strict";a("75f5")},"75f5":function(t,e,a){},"9e22":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"px-5 mb-8",attrs:{id:"page-todowizard"}},[a("b-modal",{ref:"todo-step-modal",attrs:{"hide-footer":"",title:""},model:{value:t.showStepModal,callback:function(e){t.showStepModal=e},expression:"showStepModal"}},[a("div",{staticClass:"d-block text-center"},[a("h3")]),a("b-button",{staticClass:"mt-3",attrs:{variant:"outline-success",block:""},on:{click:t.nextPage}},[t._v("OK")]),a("b-button",{staticClass:"mt-2",attrs:{variant:"outline-warning",block:""},on:{click:t.resumePage}},[t._v("Cancel")])],1),a("h4",{staticClass:"mb-8 ml-2 mt-8"},[t._v("Att göra")]),a("b-card",{staticClass:"mb-2",attrs:{title:"","hide-footer":""}},[a("div",{staticClass:"wizard wizard-3",attrs:{id:"kt_wizard_v3","data-wizard-state":"step-first","data-wizard-clickable":"true"}},[a("div",{staticClass:"wizard-nav border-bottom mb-1 mb-lg-5"},[a("div",{staticClass:"wizard-steps px-8 py-8 px-lg-15 py-lg-3"},[t._l(t.pages,(function(e,s){return[a("div",{key:s,staticClass:"wizard-step",attrs:{"data-wizard-type":"step","data-wizard-state":e.state}},[a("div",{staticClass:"wizard-label"},[a("h3",{staticClass:"wizard-title"},[a("span",[t._v(t._s(s+1))]),t._v(" "+t._s(0===s?"Introduktion":e.name)+" ")]),a("div",{staticClass:"wizard-bar"})])])]})),a("div",{staticClass:"wizard-step",attrs:{"data-wizard-type":"step","data-wizard-state":"pending"}},[a("div",{staticClass:"wizard-label"},[a("h3",{staticClass:"wizard-title"},[a("span",[t._v(t._s(t.pages.length+1))]),t._v(" Klart ")]),a("div",{staticClass:"wizard-bar"})])])],2)]),a("div",{staticClass:"row justify-content-center px-8 px-lg-10"},[a("div",{staticClass:"col-xl-12 col-xxl-7"},[a("form",{staticClass:"form",attrs:{id:"kt_form"},on:{submit:function(t){t.preventDefault()}}},[t._l(t.pages,(function(e,s){return[a("div",{key:s,staticClass:"pb-5 pt-5",attrs:{"data-wizard-type":"step-content","data-wizard-state":e.state}},[0===s?a("IntroPage",{attrs:{todo:t.todo,task:e.task}}):a("TodoWizardPage",{attrs:{page:e,todo:t.todo,task:e.task},on:{selectedStatus:t.selectedTaskStatus,fileUploaded:t.fileUploaded,disableNext:function(e){t.disabledNextButton=e}}})],1)]})),a("div",{staticClass:"pb-5",attrs:{"data-wizard-type":"step-content","data-wizard-state":"pending"}},[a("b-row",{staticStyle:{height:"300px"},attrs:{"align-v":"center"}},[a("b-col",{attrs:{align:"center"}},[a("h4",{staticClass:"font-weight-bold text-dark"},[t._v("Inlämningen är genomförd")])])],1)],1),a("div",{staticClass:"d-flex justify-content-between border-top pt-16"},[a("div",{staticClass:"mr-2"},[t.isVisablePrevious()?a("button",{staticClass:"btn btn-light-primary font-weight-bold text-uppercase px-9 py-4",attrs:{"data-wizard-type":"action-prev",disabled:t.isDisablePrevious()}},[t._v(" Föregående ")]):t._e()]),a("div",[t.isLastTask?t._e():a("button",{staticClass:"btn btn-primary font-weight-bold text-uppercase px-9 py-4",attrs:{disabled:!t.isIntro&&t.disabledNextButton},on:{click:t.getStepModal}},[t._v(" Nästa steg ")])])])],2)])])])])],1)},i=[],o=(a("caad"),a("a434"),a("b0c0"),a("96cf"),a("1da1")),n=a("5530"),d=a("bc3a"),r=a.n(d),l=a("2f62"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"card card-custom card-stretch"},[a("div",{staticClass:"card-body pt-3 pb-3"},[a("h5",{staticClass:"mb-4 mt-4"},[t._v(t._s(t.task.name))]),a("p",{staticClass:"mb-8"},[t._v(t._s(t.task.descr))]),"FILE_WIZARD"===t.task.type?a("FileTable",{attrs:{files:t.files,taskStatus:t.task.status},on:{onUploadFileClicked:t.selectFile,downloadFileClicked:t.downloadFileClicked,deleteFileClicked:t.deleteFileClicked}}):t._e(),a("input",{ref:"file",attrs:{hidden:"",type:"file",id:"file",accept:t.getExtensions()},on:{change:function(e){return t.handleFileUpload()}}}),a("ChatBox",{attrs:{comments:t.comments}}),a("b-row",{staticClass:"px-8",attrs:{"align-h":"between"}},[a("b-col",[a("b-form-group",{attrs:{id:"input-group-text",label:"Skriv meddelande","label-for":"input-text"}},[a("b-textarea",{staticClass:"mb-2",attrs:{id:"input-text"},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1)],1),a("b-col",{attrs:{md:"auto"}},[a("b-button",{staticStyle:{"margin-top":"26px",height:"55px",width:"120px"},attrs:{disabled:"COMPLETE"!==t.task.status&&"NOT"!==t.task.status,type:"button",variant:"primary"},on:{click:t.sendCommentClicked}},[t._v("Skicka")])],1)],1),a("b-row",{staticClass:"px-8"},[a("b-col",[a("p",[t._v("Bekräfta nuvarande status av din inlämning i detta steg.")]),a("label",{staticClass:"radio radio-outline radio-success mb-3"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.status,expression:"status"}],attrs:{type:"radio",value:"DONE"},domProps:{checked:t._q(t.status,"DONE")},on:{change:function(e){t.status="DONE"}}}),a("span",{staticClass:"mr-2"}),t._v(" Jag är klar med inlämning för denna åtgärd ")]),a("label",{staticClass:"radio radio-outline radio-success mr-5"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.status,expression:"status"}],attrs:{type:"radio",value:"NOT"},domProps:{checked:t._q(t.status,"NOT")},on:{change:function(e){t.status="NOT"}}}),a("span",{staticClass:"mr-2"}),t._v(" Jag är inte klar med inlämningen för denna åtgärd ")])])],1)],1)])])},u=[],p=(a("99af"),a("4de4"),a("4160"),a("159b"),a("ec6f")),h=a("b262"),m=a("c1df"),f=a.n(m),b={name:"todo-wizard-page",props:["title","page","todo","task"],components:{ChatBox:p["a"],FileTable:h["a"]},computed:Object(n["a"])({},Object(l["b"])(["currentCompanyId","currentPeriodId"])),data:function(){return{comment:"",todo_task_id:"",comments:[],files:[],status:""}},mounted:function(){console.log("TODO",this.todo),console.log("TASK",this.task),this.todo_task_id=this.task.todo_task_id,this.files=this.task.files,this.status=this.task.status,this.loadComments()},watch:{status:function(t,e){""!==t&&this.selectedTaskStatus(t)}},methods:{downloadFileClicked:function(t){var e=this;r.a.get("/file/file_id=".concat(t)).then((function(t){location.href=t.data.public_path})).catch((function(t){console.error(t),e.toastr("danger","Server Fel","Kunde inte hämta filen")}))},deleteFileClicked:function(t){var e=this;r.a.delete("/file?file_id=".concat(t,"&todo_task_id=").concat(this.task.todo_task_id)).then((function(a){e.files=e.files.filter((function(e){return e.file_id!==t}))})).catch((function(t){console.error(t),e.toastr("danger","Server Fel","Kunde inte radera filen")}))},loadComments:function(){var t=this;r.a.get("/todo_task/comments?todo_task_id=".concat(this.todo_task_id)).then((function(e){t.comments=e.data.comments})).catch((function(e){console.error(e),t.toastr("danger","Server Fel","Kunde inte hämta kommentarer")}))},sendCommentClicked:function(){var t=this;r.a.post("/todo_task/comment",{from:"sub",comment:this.comment,todo_task_id:this.todo_task_id}).then((function(e){t.comment="",t.comments.push(e.data.comment)})).catch((function(e){console.error(e),t.toastr("danger","Server Fel","Kunde inte skicka kommentar")}))},getExtensions:function(){var t="";return this.task.hasOwnProperty("valid_filtypes")&&this.task.valid_filtypes.forEach((function(e){t+=", ."+e})),t},handleFileUpload:function(){this.file=this.$refs.file.files[0],this.uploadFile()},selectFile:function(){this.$refs.file.click()},uploadFile:function(){var t=this,e=new FormData;e.append("file",this.file),e.append("file_source","todo"),e.append("file_type",this.task.category),e.append("company_id",this.currentCompanyId),e.append("todo_id",this.todo.todo_id),e.append("todo_task_id",this.task.todo_task_id),r.a.post("/fileupload?todo=true&todo_id=".concat(this.todo.todo_id,"&todo_task_id=").concat(this.task.todo_task_id),e,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){t.toastr("success","OK","Filen laddades upp"),t.file_id=e.data.fileobjs[0].file_id,t.file.created_at=f()().format("YYYY-MM-DD HH:mm:ss"),t.$emit("fileUploaded",t.file),t.files.push(t.file)})).catch((function(e){console.error(e),t.toastr("danger","Server Fel","Kunde inte ladda upp fil")}))},selectedTaskStatus:function(t){var e=this;this.$emit("disableNext",!0),r.a.put("/todo_task",{status:t,todo_task_id:this.todo_task_id}).then((function(t){e.$emit("selectedStatus",t.data.task.status),e.$emit("disableNext",!1)})).catch((function(t){return console.log(t)}))},resetForm:function(){this.comment="",this.todo_task_id="",this.comments=[],this.files=[],this.status=""},toastr:function(t,e,a){this.$bvToast.toast(a,{title:e,autoHideDelay:2e3,appendToast:!0,variant:t})}}},v=b,g=(a("1b0f"),a("2877")),_=Object(g["a"])(v,c,u,!1,null,null,null),k=_.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card card-custom card-stretch"},[a("div",{staticClass:"card-body pt-3 pb-3"},[a("h5",{staticClass:"mb-4 mt-4 "},[t._v(t._s(t.task.name))]),a("p",{staticClass:"mb-8"},[t._v(t._s(t.task.descr))]),a("div",{staticClass:"card card-custom card-stretch gutter-b"},[a("div",{staticClass:"card-body pt-0 pb-3"},[a("h6",{staticClass:"mb-4 mt-5"},[t._v("Inlämningsperiod")]),a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table table-head-custom table-vertical-center table-head-bg table-borderless"},[t._m(0),a("tbody",[a("tr",[a("td",[a("span",{staticClass:"text-dark-75  d-block font-size-lg"},[t._v(t._s(t.todo.from_datetime))])]),a("td",[a("span",{staticClass:"text-dark-75 d-block font-size-lg"},[t._v(t._s(t.todo.to_datetime))])])])])])])])]),a("div",{staticClass:"card card-custom card-stretch gutter-b"},[a("div",{staticClass:"card-body pt-0 pb-3"},[a("h6",{staticClass:"mb-4 mt-5 "},[t._v("Dina ärenden")]),a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table table-head-custom table-vertical-center table-head-bg table-borderless"},[t._m(1),a("tbody",t._l(t.todo.tasks,(function(e,s){return 0!==s?a("tr",{key:s},[a("td",[a("span",{staticClass:"text-dark-75 d-block font-size-lg",staticStyle:{width:"fit-content !important"},attrs:{id:"task-"+s}},[t._v(" "+t._s(e.name)+" ")]),a("b-popover",{attrs:{target:"task-"+s,triggers:"hover focus",content:e.descr,placement:"righttop"}})],1),a("td")]):t._e()})),0)])])])])])])},C=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",{staticClass:"text-left"},[a("th",{staticStyle:{"min-width":"110px"}},[t._v("Startdatum ")]),a("th",{staticStyle:{"min-width":"110px"}},[t._v("Slutdatum ")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",{staticClass:"text-left"},[a("th",{staticStyle:{"min-width":"110px"}},[t._v("namn ")]),a("th")])])}],x={name:"IntroPage",props:["todo","task"]},z=x,y=Object(g["a"])(z,w,C,!1,null,"61228534",null),S=y.exports,O=a("ae1f"),N=a("a7c1"),T={name:"todowizard",components:{TodoWizardPage:k,IntroPage:S},computed:Object(n["a"])(Object(n["a"])({},Object(l["b"])(["currentCompanyId","currentPeriodId"])),{},{isLastTask:function(){return console.log("TODO-WIZARD",this.wizard?this.wizard.getStep():"",this.pages.length),!!this.wizard&&this.wizard.getStep()===this.pages.length+1},isIntro:function(){return!!this.wizard&&1===this.wizard.getStep()}}),mounted:function(){this.loadData()},data:function(){return{disabledNextButton:!0,form:{},showNext:!0,currentPage:0,wizard:null,order:{},pages:[],todo:null,task:null,todo_id:null,showStepModal:!1}},watch:{showNext:function(t,e){console.log("showNext changed: "+t)}},methods:{selectedTaskStatus:function(t){this.disabledNextButton=!1,this.wizard&&(this.pages[this.wizard.currentStep-1].task.status=t)},fileUploaded:function(t){},isVisablePrevious:function(){return!this.isLastTask},isDisablePrevious:function(){var t=!1;return t},getStepModal:function(){var t=["COMPLETE"],e=this.pages[this.wizard.currentStep-1].task.status;t.includes(e)?this.showStepModal=!0:this.nextPage()},resumePage:function(t){this.showStepModal=!1,this.wizard.resume()},nextPage:function(t){var e=["DONE","NOT"],a=this.pages[this.wizard.currentStep]&&e.includes(this.pages[this.wizard.currentStep].task.status);this.showStepModal=!1,this.disabledNextButton=!a&&!this.pages[this.wizard.getStep()-1].valid,this.wizard.goNext()},isValid:function(t,e){console.log("received isValid signal from "+e+": "+t);var a=0;void 0!==this.wizard&&null!==this.wizard&&(a=this.wizard.getStep()-1),console.log("currentstep: "+a+" index: "+e),e==a?(this.showNext=t,console.log("showing next: "+t),this.disabledNextButton=!t):console.log("not showing next"),this.pages.length>e&&(this.pages[e].valid=t)},finish:function(){var t=this;r.a.put("/todo",{status:"DONE",todo_id:this.todo_id}).then((function(e){t.toastr("success","OK","Status uppdaterat")})).catch((function(e){console.error(e),t.toastr("danger","Fel","Kunde inte uppdatera status")}))},createWizard:function(){var t=this;t.showNext=!0,t.wizard=new N["a"]("kt_wizard_v3",{startStep:1,clickableSteps:!0}),t.wizard.on("beforeNext",(function(){})),t.wizard.on("change",(function(){setTimeout((function(){O["a"].scrollTop(),t.currentPage=t.wizard.currentStep,t.currentPage-1===t.pages.length&&console.log("last page")}),200)})),t.showNext=!1},loadData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.todo_id=t.$route.params.id,r.a.get("/todo?todo_id=".concat(t.todo_id)).then((function(e){t.todo=e.data.todo,t.todo.tasks.splice(0,0,{name:e.data.todo.name,descr:e.data.todo.descr}),t.pages=[];for(var a=0;a<t.todo.tasks.length;++a){var s=t.todo.tasks[a];t.pages.push({type:0===a?"intro":"normal",state:0===a?"current":"pending",name:s.name,index:a,task:s})}var i=t;setTimeout((function(){i.createWizard()}),100)})).catch((function(e){console.error(e),t.toastr("danger","Server Fel","Kunde inte hämta att-göra data")}));case 2:case"end":return e.stop()}}),e)})))()},toastr:function(t,e,a){this.$bvToast.toast(a,{title:e,autoHideDelay:2e3,appendToast:!0,variant:t})}}},F=T,P=(a("d555"),Object(g["a"])(F,s,i,!1,null,"14015406",null));e["default"]=P.exports},d555:function(t,e,a){"use strict";a("dcfe6")},dcfe6:function(t,e,a){},ec6f:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card card-custom card-stretch gutter-b"},[t._m(0),a("div",{staticClass:"card-body pt-0 px-8"},[0===t.comments.length?a("p",[t._v("Det finns inga meddelanden i åtgärden")]):t._e(),t._l(t.comments,(function(e,s){return[a("div",{key:s,staticClass:"mb-10"},[a("div",{staticClass:"d-flex align-items-center"},[a("div",{staticClass:"symbol symbol-45 symbol-light mr-5"},[a("span",{staticClass:"symbol-label"},[a("inline-svg",{staticClass:"h-50 align-self-center",attrs:{src:"/assets/svg/User.svg"}})],1)]),a("div",{staticClass:"d-flex flex-column flex-grow-1"},[a("a",{staticClass:"font-weight-bold text-dark-75 text-hover-primary font-size-lg mb-1",attrs:{href:"#"}},[t._v(" "+t._s(e.from)+" ")]),a("span",{staticClass:"text-muted font-weight-bold"},[t._v(" "+t._s(e.created_at)+" ")])])]),a("p",{staticClass:"text-dark-50 m-0 pt-5 font-weight-normal"},[t._v(" "+t._s(e.text)+" ")])])]}))],2)])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-header border-0"},[a("h3",{staticClass:"card-title font-weight-bolder text-dark"},[t._v("Meddelanden")])])}],o=a("5530"),n=a("2f62"),d={name:"chatBox",props:["comments"],components:{},computed:Object(o["a"])({},Object(n["b"])(["currentCompanyId"])),data:function(){return{}},watch:{},methods:{},mounted:function(){}},r=d,l=a("2877"),c=Object(l["a"])(r,s,i,!1,null,null,null);e["a"]=c.exports}}]);
//# sourceMappingURL=chunk-57badf00.3ceae26e.js.map